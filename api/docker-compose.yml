services:
  # drep delegator feedback API Server
  drep-delegator-feedback-api:
    build:
      context: .
      dockerfile: Dockerfile
    image: drep-delegator-feedback-api:latest
    container_name: drep_delegator_feedback_api
    env_file:
      - .env
    extra_hosts:
      - "host.docker.internal:host-gateway"
    ports:
      - "${PORT:-3001}:${PORT:-3001}"
    environment:
      # Override DATABASE_URL to connect to host machine's database
      DATABASE_URL: postgresql://postgres@host.docker.internal:5432/drep-delegator-feedback-db-2

      # Disable cron jobs in API (they run in separate service)
      DISABLE_CRON_IN_API: "true"
    restart: unless-stopped
    command: ["node", ".build/index.js"]
    # Uncomment if you need to connect to other services via external network
    # networks:
    #   - shared-network

  # drep delegator feedback Cron Service
  cardano-governance-action-sync-cron:
    build:
      context: .
      dockerfile: Dockerfile
    image: drep-delegator-feedback-api:latest
    container_name: cardano_governance_action_sync_cron
    env_file:
      - .env
    extra_hosts:
      - "host.docker.internal:host-gateway"
    environment:
      # Override DATABASE_URL to connect to host machine's database
      DATABASE_URL: postgresql://postgres@host.docker.internal:5432/drep-delegator-feedback-db-2

      # Override cron schedule for testing (every 1 minute)
      # Comment this out to use the schedule from .env (every 5 minutes)
      # PROPOSAL_SYNC_SCHEDULE: "* * * * *"
    restart: unless-stopped
    command: ["node", ".build/cron.js"]
    # Uncomment if you need to connect to other services via external network
    # networks:
    #   - shared-network
# Uncomment if you need to connect to other docker-compose services
# Create the network first: docker network create shared-network
# networks:
#   shared-network:
#     external: true
